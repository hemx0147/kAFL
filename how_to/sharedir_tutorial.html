<!doctype html>
<html class="no-js" lang="en">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" />

    <!-- Generated with Sphinx 5.3.0 and Furo 2022.12.07 -->
        <title>Using Nyx htools + sharedir for OS Fuzzing - kAFL</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?digest=91d0f0d1c444bdcb17a68e833c7a53903343c195" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?digest=30d1aed668e5c3a91c3e3bf6a60b675221979f0e" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">kAFL</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
  
  
  <span class="sidebar-brand-text">kAFL</span>
  
</a><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/fuzzing_linux_kernel.html">Fuzzing the Linux Kernel</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../reference/deployment.html">Deployment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/hypercall_api.html">kAFL/Nyx Hypercall API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/workdir_layout.html">kAFL Workdir</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/user_interface.html">kAFL User Interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../dev/documentation.html">Building the documentation</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="edit-this-page">
  <a class="muted-link" href="https://github.com/IntelLabs/kAFL/edit/docs/docs/source/how_to/sharedir_tutorial.md" title="Edit this page">
    <svg aria-hidden="true" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" />
      <line x1="13.5" y1="6.5" x2="17.5" y2="10.5" />
    </svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto"><use href="#svg-sun-half"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main">
          <section id="using-nyx-htools-sharedir-for-os-fuzzing">
<h1>Using Nyx htools + sharedir for OS Fuzzing<a class="headerlink" href="#using-nyx-htools-sharedir-for-os-fuzzing" title="Permalink to this heading">#</a></h1>
<p>The kAFL/Nyx <code class="docutils literal notranslate"><span class="pre">sharedir</span></code> option replaces the <code class="docutils literal notranslate"><span class="pre">agent</span></code> option in kAFL v0.2. The
old <code class="docutils literal notranslate"><span class="pre">agent</span></code> was required to be a single binary resulting in all kind of fancy
packaging approaches. With the sharedir option, the ‘loader’ can be a simple
shell script which in turn loads additional components via hypercalls
transparent to the target.</p>
<p><em>TODO</em>: The Nyx htools are not currently integrated but must be sourced separately from <a class="reference external" href="https://github.com/nyx-fuzz/packer">Nyx/packer</a>.</p>
<p>To avoid frequent modifications to the target VM image, we use a minimal fixed
<code class="docutils literal notranslate"><span class="pre">loader.sh</span></code> integrated in the boot image. The <code class="docutils literal notranslate"><span class="pre">loader.sh</span></code> has the single purpose
to load a second stage loader script, dubbed <code class="docutils literal notranslate"><span class="pre">agent.sh</span></code> below. All actual
harness setup and execution is performed in this second stage.</p>
<section id="create-linux-vm-image">
<h2>Create Linux VM Image<a class="headerlink" href="#create-linux-vm-image" title="Permalink to this heading">#</a></h2>
<p>Create Linux VM image using regular (non-patched) Qemu.</p>
<p>For initial hello world it is recommended to use a recent Linux version.
Currently most testing is done with Ubuntu 20.04.</p>
<p>Consider using the same for host and guest to avoid problems with
cross-compiling agent binaries.</p>
<p>Activate the serial console and disable kASLR / PTI in Linux, e.g.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">tee</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">default</span><span class="o">/</span><span class="n">grub</span> <span class="o">&lt;&lt;</span> <span class="n">HERE</span>
<span class="n">GRUB_CMDLINE_LINUX_DEFAULT</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="n">GRUB_CMDLINE_LINUX</span><span class="o">=</span><span class="s2">&quot;nokaslr console=ttyS0 oops=panic nopti mitigations=off spectre_v2=off&quot;</span>
<span class="n">GRUB_TIMEOUT_STYLE</span><span class="o">=</span><span class="n">menu</span>
<span class="n">GRUB_TIMEOUT</span><span class="o">=</span><span class="mi">1</span>
<span class="n">GRUB_DISABLE_RECOVERY</span><span class="o">=</span><span class="n">true</span>
<span class="n">HERE</span>
<span class="n">update</span><span class="o">-</span><span class="n">grub</span>
</pre></div>
</div>
</section>
<section id="deploy-loader-script">
<h2>Deploy Loader Script<a class="headerlink" href="#deploy-loader-script" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Mount VM image</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>sudo bash
modprobe nbd
qemu-nbd -c /dev/nbd0 $TARGET/image.qcow2
mount /dev/nbd0p1 /mnt/
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Deploy loader components</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">~/</span><span class="n">kafl</span>
<span class="n">mkdir</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">fuzz</span>
<span class="n">cp</span> <span class="o">~/</span><span class="n">kafl</span><span class="o">/</span><span class="n">targets</span><span class="o">/</span><span class="n">linux_x86_64</span><span class="o">/</span><span class="n">loader</span><span class="o">.</span><span class="n">sh</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span>
<span class="n">cp</span> <span class="o">~/</span><span class="n">kafl</span><span class="o">/</span><span class="n">targets</span><span class="o">/</span><span class="n">linux_x86_64</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">htools</span><span class="o">/</span><span class="n">hget</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/</span>
<span class="n">chmod</span> <span class="n">a</span><span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">fuzz</span><span class="o">/*</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Activate loader.sh on &#64;reboot</p></li>
</ol>
<p>The manual snapshot via LOCK hypercall still needs some fixing. Instead, we will
manually launch the loader.sh via cron. Make sure you have cron instaled in the
guest.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">echo</span> <span class="s2">&quot;@reboot root /fuzz/loader.sh&quot;</span> <span class="o">&gt;&gt;</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">crontab</span>
</pre></div>
</div>
<ol class="arabic simple" start="4">
<li><p>Unount and disconnect VM image (<code class="docutils literal notranslate"><span class="pre">important!</span></code>)</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">umount</span> <span class="o">/</span><span class="n">mnt</span>
<span class="n">qemu</span><span class="o">-</span><span class="n">nbd</span> <span class="o">-</span><span class="n">d</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">nbd0</span>
</pre></div>
</div>
</section>
<section id="prepare-sharedir-and-launch-vm">
<h2>Prepare sharedir and launch VM<a class="headerlink" href="#prepare-sharedir-and-launch-vm" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p>Prepare the sharedir. We include the vulnerable test driver
<code class="docutils literal notranslate"><span class="pre">kafl_vuln_test.ko</span></code> and the corresponding fuzzer agents.</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="o">~/</span><span class="n">sharedir</span>
<span class="n">cp</span> <span class="o">~/</span><span class="n">kafl</span><span class="o">/</span><span class="n">target</span><span class="o">/</span><span class="n">linux_x86_64</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">htools</span><span class="o">/*</span> <span class="o">~/</span><span class="n">sharedir</span><span class="o">/</span>
<span class="n">cp</span> <span class="o">~/</span><span class="n">kafl</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">test_cases</span><span class="o">/</span><span class="n">simple</span><span class="o">/</span><span class="n">linux_x86</span><span class="o">-</span><span class="mi">64</span><span class="o">/</span><span class="n">kafl_vuln_test</span><span class="o">.</span><span class="n">ko</span> <span class="o">~/</span><span class="n">sharedir</span><span class="o">/</span>
<span class="n">cp</span> <span class="o">~/</span><span class="n">kafl</span><span class="o">/</span><span class="n">targets</span><span class="o">/</span><span class="n">linux_x86_64</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fuzzer</span><span class="o">/</span><span class="n">kafl_vuln_test</span> <span class="o">~/</span><span class="n">sharedir</span><span class="o">/</span>
<span class="n">cp</span> <span class="o">~/</span><span class="n">kafl</span><span class="o">/</span><span class="n">targets</span><span class="o">/</span><span class="n">linux_x86_64</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">fuzzer</span><span class="o">/</span><span class="n">hprintf_test</span> <span class="o">~/</span><span class="n">sharedir</span><span class="o">/</span>
<span class="n">cp</span> <span class="o">~/</span><span class="n">kafl</span><span class="o">/</span><span class="n">targets</span><span class="o">/</span><span class="n">linux_x86_64</span><span class="o">/</span><span class="n">agent</span><span class="o">.</span><span class="n">sh</span> <span class="o">~/</span><span class="n">sharedir</span><span class="o">/</span>
</pre></div>
</div>
<p>Review <code class="docutils literal notranslate"><span class="pre">loader.sh</span></code> and <code class="docutils literal notranslate"><span class="pre">agent.sh</span></code> to understand the startup flow. The main
secret ingredient here is <code class="docutils literal notranslate"><span class="pre">hget</span></code>, which issues a hypercall to fetch a file from
<code class="docutils literal notranslate"><span class="pre">$sharedir</span></code> and stores it locally inside the guest. This way, the VM can fetch
all and any other components from sharedir at runtime.</p>
<ol class="arabic simple" start="2">
<li><p>Selecting the target IP range</p></li>
</ol>
<p>kAFL requires you to select a reasonable IP range for tracing + decoding. While
it is still possible to supply this range using -ip<N> parameter, the
recommended option for targets such as Linux is to set the filter range(s) as
part of fuzzer initialization inside the guest.</p>
<p>The provided example uses a combination of <code class="docutils literal notranslate"><span class="pre">hinfo</span></code> and <code class="docutils literal notranslate"><span class="pre">hrange</span></code> tools to
accomplish this for the <code class="docutils literal notranslate"><span class="pre">kafl_vuln_test</span></code> sample. <code class="docutils literal notranslate"><span class="pre">hinfo</span></code> corresponds to the
original kAFL <code class="docutils literal notranslate"><span class="pre">info</span></code> agent and simply dumps the IP ranges of all loaded kernel
modules. <code class="docutils literal notranslate"><span class="pre">hrange</span></code> takes a list of IP ranges and configures them using
hypercalls. A possible use can be seen in <code class="docutils literal notranslate"><span class="pre">agent.sh</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># dump all info to stdout (loader.sh redirects this to hcat!)</span>
<span class="n">hinfo</span>
<span class="c1"># grep for target module and pipe ranges to hrange</span>
<span class="n">hinfo</span> <span class="o">|</span><span class="n">grep</span> <span class="n">kafl_vuln</span><span class="o">|</span><span class="n">awk</span> <span class="s1">&#39;{print NR-1&quot;:&quot;$1}&#39;</span><span class="o">|</span><span class="n">xargs</span> <span class="n">hrange</span> 
</pre></div>
</div>
<p>Review the source code for usage and setting further/custom filter ranges.</p>
<ol class="arabic simple" start="3">
<li><p>Launch VM in the Fuzzer</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>python3 ~/kafl/kafl_fuzz.py \
	--purge -p 1 -D -redqueen \
	-vm_image $TARGET/image.qcow2 \
	-mem 512 \
	-work_dir /dev/shm/kafl_ubuntu \
    -seed_dir ~/seeds/
	-sharedir ~/sharedir/
</pre></div>
</div>
<p>By default, the serial output is now logged to <code class="docutils literal notranslate"><span class="pre">$workdir/qemu_serial_&lt;N&gt;.log</span></code>.
The example scripts also make ample use of <code class="docutils literal notranslate"><span class="pre">hcat</span></code>, a simple frontend to
<code class="docutils literal notranslate"><span class="pre">hprintf()</span></code> which can be used to send printf strings directly to the python
frontend.</p>
<p>If the example does not work immediately, review these output messages together
with the shell scripts and agent code. Also consider switching to the more
verbose <code class="docutils literal notranslate"><span class="pre">hprintf_test</span></code> agent.</p>
</section>
<section id="notes">
<h2>Notes<a class="headerlink" href="#notes" title="Permalink to this heading">#</a></h2>
<ul>
<li><p>At any point in time, the image can be launched with regular/unpatched Qemu.
The special kAFL/Nyx hypercalls will not work in this mode and the <code class="docutils literal notranslate"><span class="pre">hget/hcat</span></code>
tools will simply exit with an error.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">htools</span></code> are intended as a simple baseline to bootstrap different fuzzing scenarios.
Some of these tools can be used outside the kAFL environment, e.g. hinfo will
still dump the kernel modules’ IP ranges.</p>
<p>You may need to deploy your own / additional tools to extract special address
ranges, functions to hook etc.</p>
</li>
<li><p>Files downloaded into the guest still need to be executable there.  In
particular, the <code class="docutils literal notranslate"><span class="pre">kafl_vuln_test.ko</span></code> will typically fail if it is not compiled
for the kernel running inside the VM. The htools and fuzzer agents are simple
enough to just work on most Linux systems, but more complex agents require
static linking or installing the required runtime libraries inside the guest VM.</p></li>
<li><p>Nyx will automatically snapshot the target VM when it encounters the first
<code class="docutils literal notranslate"><span class="pre">NEXT_PAYLOAD</span></code> hypercall from the fuzzing main loop. This means it is okay to
have a longer startup / preparation phase before actual fuzzing. Additional VM
instances (<code class="docutils literal notranslate"><span class="pre">kafl_fuzz.py</span> <span class="pre">-p</span></code>) are started only after the initial snapshot is
done and will directly resume from the snapshot.</p></li>
<li><p>kAFL currently prints status messages to the main console even when its Qemu
instances may still be in waiting state due to VM bootup / snapshotting.</p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          
          
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2022, Steffen Schulz - Mathieu Tarral
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            <div class="icons">
              <a class="muted-link " href="https://github.com/IntelLabs/kAFL" aria-label="GitHub">
                <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path>
                </svg>
            </a>
              
            </div>
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Using Nyx htools + sharedir for OS Fuzzing</a><ul>
<li><a class="reference internal" href="#create-linux-vm-image">Create Linux VM Image</a></li>
<li><a class="reference internal" href="#deploy-loader-script">Deploy Loader Script</a></li>
<li><a class="reference internal" href="#prepare-sharedir-and-launch-vm">Prepare sharedir and launch VM</a></li>
<li><a class="reference internal" href="#notes">Notes</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/furo.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/design-tabs.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    </body>
</html>